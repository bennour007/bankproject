---
title: "Bank project"
output:
  html_document:
    df_print: paged
    toc: yes
  pdf_document:
    toc: yes
  html_notebook:
    df_print: paged
    fig_caption: yes
    fig_height: 6
    fig_width: 9
    highlight: pygments
    number_sections: yes
    theme: flatly
    toc: yes
editor_options:
  chunk_output_type: inline
---

```{r include=FALSE}
suppressPackageStartupMessages(library(here))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(purrr))
suppressPackageStartupMessages(library(DataExplorer))
suppressPackageStartupMessages(library(moments))
```


# Loading data

```{r}
bank_df <- here("Datasets", "bank.csv") %>% 
  read.csv2
bank_df %>%
  head
```

## Code book

**age** (numeric)

**job** type of job (categorical: 'admin.','blue-collar','entrepreneur','housemaid','management','retired','self-employed','services','student','technician','unemployed','unknown')

**marital** marital status (categorical: 'divorced','married','single','unknown'; note: 'divorced' means divorced or widowed)

**education** (categorical: 'basic.4y','basic.6y','basic.9y','high.school','illiterate','professional.course','university.degree','unknown')

**default** has credit in default? (categorical: 'no','yes','unknown')

**housing** has housing loan? (categorical: 'no','yes','unknown')

**loan** has personal loan? (categorical: 'no','yes','unknown')

*related with the last contact of the current campaign*

**contact** contact communication type (categorical: 'cellular','telephone')

**month** last contact month of year (categorical: 'jan', 'feb', 'mar', ..., 'nov', 'dec')

**day_of_week** last contact day of the week (categorical: 'mon','tue','wed','thu','fri')

**duration** last contact duration, in seconds (numeric). Important note: this attribute highly affects the output target (e.g., if duration=0 then y='no'). Yet, the duration is not known before a call is performed. Also, after the end of the call y is obviously known. Thus, this input should only be included for benchmark purposes and should be discarded if the intention is to have a realistic predictive model.

*other attributes*

**campaign** number of contacts performed during this campaign and for this client (numeric, includes last contact)

**pdays** number of days that passed by after the client was last contacted from a previous campaign (numeric; 999 means client was not previously contacted)

**previous** number of contacts performed before this campaign and for this client (numeric)

**poutcome** outcome of the previous marketing campaign (categorical: 'failure','nonexistent','success')

```{r}
str(bank_df)
```

# Exploring the data

## Checking for missing values

```{r}
plot_missing(bank_df)
```
The dataset does not contain missing values


## Differentiating variables types

### Categorical variables

```{r}
cat_df <- bank_df %>%
  select_if(is.factor)
cat_df %>% 
  head
```

### Continuous variables

```{r}
cont_df <- bank_df %>%
  select_if(is.numeric)
cont_df %>% 
  head
```

## Univariate exploration

### Categorical variables

```{r}
plot_bar(cat_df[,1:3])
plot_bar(cat_df[,4:6])
plot_bar(cat_df[,7:8])
plot_bar(cat_df[,9:10])
```

### Continuous variables

```{r}
plot_histogram(cont_df[,1:3])
plot_histogram(cont_df[,4:7])
```

```{r}
plot_density(cont_df[,1:2])
plot_density(cont_df[,3:4])
plot_density(cont_df[,4:6])
```

We explore their skewness and kurtosises.

#### Kurtosises

```{r}
cont_df %>% map(kurtosis)
```
```{r}
cont_df %>% map(skewness)
```

#### Skewness

```{r}
cont_df %>% map(skewness)
```

#### Quartiles and outliers

```{r}
l <- length(cont_df)
plotsList <- vector("list", l)

for (i in 1:l) {
  col <- cont_df[,i]
  colName <- cont_df %>% colnames %>% .[i]
  p <- plot_ly(x = col, type = "box", name = colName)
  plotsList[[i]] <- p 
}
subplot(plotsList[1:2], nrows = 1, margin = 0.09)
subplot(plotsList[3:4], nrows = 1, margin = 0.09)
subplot(plotsList[5], nrows = 1, margin = 0.09)
```

## Bivariate exploration

### Correlation matrix

```{r}
plot_correlation(cont_df)
plot_correlation(cat_df)
plot_correlation(bank_df)
```

### Distribution relative to age

```{r}
plot_scatterplot(cont_df, by="age")
```

### Distribution relative to day

```{r}
cont_df %>% 
  plot_scatterplot(by="day")
```

### Distribution relative to balance

```{r}
cont_df %>% 
  plot_scatterplot(by="balance")
```
### Distribution relative to duration

```{r}
cont_df %>% 
  plot_scatterplot(by="duration")
```

### Boxplots based on outcome y

```{r}
bank_df %>% 
  plot_boxplot(by="y")
```


### Boxplots based on outcome marital satus

```{r}
bank_df %>% 
  plot_boxplot(by="marital")
```

### Boxplots based on outcome marital education

```{r}
bank_df %>% 
  plot_boxplot(by="education")
```

### Boxplots based on outcome marital previous outcome

```{r}
bank_df %>% 
  plot_boxplot(by="poutcome")
```

### Boxplots based on outcome marital previous housing

```{r}
bank_df %>% 
  plot_boxplot(by="housing")
```

### Checking for normality

```{r}
bank_df %>% 
  plot_qq
```


### Checking for normality based on outcome

```{r}
bank_df %>% 
  plot_qq(by="y")
```
